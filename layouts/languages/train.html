{{ define "main" }}
{{ $lang := .Params.language }}
{{ $groupsPage := .Parent.GetPage "groups" }}
{{ $groupsData := slice }}
{{ if $groupsPage }}
{{ range $groupsPage.Pages }}
{{ $data := dict "group_id" .Params.group_id "group_title" .Params.group_title "description" .Params.description
"sentences" .Params.sentences }}
{{ $groupsData = $groupsData | append $data }}
{{ end }}
{{ end }}

<div class="utteron-container train-container" id="train-app" data-language="{{ $lang }}"
    data-groups='{{ $groupsData | jsonify }}'>

    <div class="train-header">
        <a href="{{ .Parent.Permalink }}" class="back-link">‚Üê Back</a>
        <h1 id="group-title">Select a Group</h1>
        <p class="group-subtitle" id="group-subtitle"></p>
    </div>

    <!-- Exercise Card -->
    <div class="exercise-card" id="exercise-card" style="display: none;">

        <!-- Progress Indicator -->
        <div class="progress-indicator">
            <div class="progress-text">
                <span id="current-index">1</span> / <span id="total-count">1</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="progress-bar"></div>
            </div>
        </div>

        <!-- Exercise Type Indicator -->
        <div class="exercise-type" id="exercise-type"></div>

        <!-- Prompt Area (what user sees first) -->
        <div class="prompt-area" id="prompt-area"></div>

        <!-- Audio Player (hidden, controlled via button) -->
        <div class="audio-container" id="audio-container">
            <audio id="audio-player"></audio>
            <button class="replay-btn" id="replay-btn" aria-label="Play audio">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                <span>Play Audio</span>
            </button>
        </div>

        <!-- Reveal Area (shown after reveal) -->
        <div class="reveal-area" id="reveal-area" style="display: none;"></div>

        <!-- Action Button (always in same position) -->
        <div class="action-area">
            <button class="action-btn primary" id="action-btn">Reveal</button>
        </div>

        <!-- Self Report Buttons (shown after reveal) -->
        <div class="report-buttons" id="report-buttons" style="display: none;">
            <button class="report-btn missed" id="missed-btn">Missed it</button>
            <button class="report-btn got-it" id="got-it-btn">Got it</button>
        </div>
    </div>

    <!-- Completion Message -->
    <div class="completion-message" id="completion-message" style="display: none;">
        <div class="completion-header">
            <div class="completion-icon" id="completion-icon">üéâ</div>
            <h2 id="completion-title">Session Complete!</h2>
            <p class="completion-subtitle" id="completion-subtitle">Great work!</p>
        </div>

        <div class="completion-stats-card">
            <div class="stat-row primary">
                <div class="stat-circle" id="accuracy-circle">
                    <svg viewBox="0 0 100 100">
                        <circle class="circle-bg" cx="50" cy="50" r="45"></circle>
                        <circle class="circle-fill" cx="50" cy="50" r="45" id="accuracy-progress"></circle>
                    </svg>
                    <div class="stat-value" id="accuracy-value">0%</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Total</div>
                    <div class="stat-value" id="total-questions">0</div>
                </div>
                <div class="stat-item success">
                    <div class="stat-label">Correct</div>
                    <div class="stat-value" id="correct-count">0</div>
                </div>
                <div class="stat-item error">
                    <div class="stat-label">Missed</div>
                    <div class="stat-value" id="missed-count">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Accuracy</div>
                    <div class="stat-value" id="accuracy-text">0%</div>
                </div>
            </div>

            <p class="performance-message" id="performance-message">Keep practicing!</p>
        </div>

        <div class="completion-actions">
            <a href="{{ .Parent.Permalink }}" class="action-btn secondary">‚Üê Back to Groups</a>
            <button class="action-btn primary" id="retry-btn">Try Again</button>
        </div>
    </div>

    <!-- No Group Selected -->
    <div class="no-group" id="no-group">
        <p>No group selected. Please go back and choose a sentence group.</p>
        <a href="{{ .Parent.Permalink }}" class="action-btn">‚Üê Choose Group</a>
    </div>
</div>

<script src="/js/utteron.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        initTrainingInterface();
    });
</script>
{{ end }}