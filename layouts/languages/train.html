{{ define "main" }}
{{ $lang := .Params.language }}
{{ $groupsPage := .Parent.GetPage "groups" }}
{{ $groupsData := slice }}
{{ if $groupsPage }}
{{ range $groupsPage.Pages }}
{{ $data := dict "group_id" .Params.group_id "group_title" .Params.group_title "description" .Params.description
"sentences" .Params.sentences }}
{{ $groupsData = $groupsData | append $data }}
{{ end }}
{{ end }}

<div class="utteron-container train-container" id="train-app" data-language="{{ $lang }}"
    data-groups='{{ $groupsData | jsonify }}'>

    <div class="train-header">
        <a href="{{ .Parent.Permalink }}" class="back-link">‚Üê Back</a>
        <h1 id="group-title">Select a Group</h1>
        <p class="group-subtitle" id="group-subtitle"></p>
    </div>

    <!-- Exercise Card -->
    <div class="exercise-card" id="exercise-card" style="display: none;">

        <!-- Exercise Type Indicator -->
        <div class="exercise-type" id="exercise-type"></div>

        <!-- Prompt Area (what user sees first) -->
        <div class="prompt-area" id="prompt-area"></div>

        <!-- Audio Player (hidden, controlled via button) -->
        <div class="audio-container" id="audio-container">
            <audio id="audio-player"></audio>
            <button class="replay-btn" id="replay-btn" aria-label="Play audio">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                <span>Play Audio</span>
            </button>
        </div>

        <!-- Reveal Area (shown after reveal) -->
        <div class="reveal-area" id="reveal-area" style="display: none;"></div>

        <!-- Action Button (always in same position) -->
        <div class="action-area">
            <button class="action-btn primary" id="action-btn">Reveal</button>
        </div>

        <!-- Self Report Buttons (shown after reveal) -->
        <div class="report-buttons" id="report-buttons" style="display: none;">
            <button class="report-btn missed" id="missed-btn">Missed it</button>
            <button class="report-btn got-it" id="got-it-btn">Got it</button>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
            <span id="current-index">1</span> / <span id="total-count">1</span>
        </div>
    </div>

    <!-- Completion Message -->
    <div class="completion-message" id="completion-message" style="display: none;">
        <h2>üéâ Session Complete!</h2>
        <p>You've completed all exercises in <strong id="group-name"></strong>.</p>
        <div class="completion-actions">
            <a href="{{ .Parent.Permalink }}" class="action-btn">‚Üê Back to Groups</a>
        </div>
    </div>

    <!-- No Group Selected -->
    <div class="no-group" id="no-group">
        <p>No group selected. Please go back and choose a sentence group.</p>
        <a href="{{ .Parent.Permalink }}" class="action-btn">‚Üê Choose Group</a>
    </div>
</div>

<script src="/js/utteron.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        initTrainingInterface();
    });
</script>
{{ end }}